# 指摘事項

- src/App.tsx (lines 121-187) で行動構築時にMPを消費し、更新時にも同額を再度減算しており、全スキルが実質2倍のMP消費になります。

- src/data/skillData.ts (lines 118-132) のマジックバリアは key: 'magic_resist' を付与しますが、src/engine/statusManager.ts 側は magic_shield を参照しているため効果が一切発揮されません。

- src/data/characterData.ts (line 43) megazaru、 (line 260) rukani など、SKILLS に存在しないIDが混ざっており、戦闘中に「skill_not_found」扱いになります（mega_zaru / ruka_ni が正）。

- src/engine/actionResolver.ts (lines 105-138) で命中判定をダメージ適用後に行っているため、ミス扱いでもダメージが発生します。chance を持つデバフ系も確率を無視して必ず付与を試みます。

- ステータス効果を付与しても、攻防速計算やターン順 (turnOrder.ts) に反映していないため、バフ/デバフが実質ほぼ無効です（魔法軽減のみ部分適用）。

- src/engine/actionResolver.ts (lines 144-149) で回復・蘇生時の最大HP上限チェックがなく、HPが際限なく増加する設計になっています。

## 環境・設計改善案

- バトルエンジンのユニットテストを追加し、MP消費・命中判定・バフ反映・スキルIDの整合性を検証できるようにする（シード可能な乱数を用意すると再現性が上がります）。

- 型/データ整合性を守るため、スキルIDをenum的に管理し、キャラデータをビルド時に検証するスキーマチェックを導入する。

- 最大HP/MPと現在値を別フィールドで管理し、回復時にクランプするようにモデルを見直す。

- バフ/デバフ効果の適用ポイント（行動順決定・ダメージ計算・成功判定）を統一する設計ドキュメントを用意し、計算ロジックを一箇所に寄せると保守性が向上します。