ドラクエ2のような古典的JRPG風ターン制バトルゲーム
3vs3の戦闘（プレイヤー側3人、敵側3体）
ブラウザ（PC想定）
使用言語はTypeScript/React

### ゲーム要件定義

- バトルシステム
    - キャラクターごとにコマンド入力
    - コマンド種類： 攻撃、スキル、防御
        - 防御はダメージ半減、必ず先制する
    - ターゲット：
        - 攻撃/ダメージ特技 → 敵を選択
        - 回復/バフ特技 → 味方を選択
        - 全体攻撃 → 自動で全体適用
    - 勝利条件：相手チーム全滅
    - 5連勝でゲームクリア
- ターン進行
    - 素早さ順で戦闘時の行動を行う
    - 素早さは1~5段階で同値の場合ランダム
- UI
    - ファミコン風テキストベース
    - 絵文字使用可
    - HP/MPバー表示

### キャラ

- **ステータス**: HP、MP、攻撃力、防御力、素早さ
    - HPは60~100として並みの攻撃力4～5発くらいの通常攻撃で倒されるバランス
- **属性**: なし
- スキル: キャラ固有で1〜3個
    - 補助や回復役は多め
- **成長**: なし（固定ステータス）
    - 勝利報酬で多少は上がるが、インフレしないようにする。攻撃呪文のダメージ量も固定。
- **種類**: 10種類程度
- キャラ特徴・ロール
    - 戦士系…高耐久の壁役、味方を守ったり敵を妨害する
    - 武闘家系…攻撃力とシナジーのある特技を使う
    - 魔法使い系…高火力な攻撃呪文を使うがMP切れやすい、補助呪文は低コストで使える
    - 僧侶系…回復、バフ、蘇生、長期戦になるほど強い

### スキル

消費MPやダメージ量などの具体的な数値は調整しながら決める

攻撃呪文のダメージは定量。相手の防御力を貫通するイメージ。マジックバリアで対策可能。

バフ・デバフの効果時間は3ターン。上書きによる効果持続はなし。バフがかかっている相手にデバフがかかった場合、効果を打ち消す。

防御・仁王立ちは必ず先制する。疾風突きはその次に優先される。同じ優先度のスキルが選択された場合ランダム。

HPの回復は最大HPまで

- 攻撃呪文
    - メラミ　中ダメージ
    - メラゾーマ　大ダメージ
    - イオラ　敵全体に中ダメージ
    - イオナズン　敵全体に大ダメージ
- 補助呪文
    - バイキルト　味方の攻撃力Up
    - スカラ　味方の守備力Up
    - ピオラ　味方の素早さUp
    - マジックバリア　味方全員攻撃呪文半減
    - ルカニ　敵の守備力Down
    - ヘナトス　敵の攻撃力Down
- 攻撃特技
    - 兜割り　50%で敵の守備力Down
    - 刃砕き　50%で敵の攻撃力Down
    - 疾風突き　必ず先制　0.75倍のダメージ
    - 五月雨突き　0.5倍のダメージをランダムに4回
    - 魔人斬り　大ダメージorミス
    - なぎ払い　敵全体にダメージ
    - はやぶさ斬り　0.75倍のダメージを2回
    - ミラクルソード　与えたダメージの半分を回復
    - 捨て身攻撃　ダメージ2倍守備半減
- 補助特技
    - 仁王立ち　味方のダメージをすべて引き受ける　必ず先制する
    - おたけび　33％で1ターン休み　敵全体
    - ためる　次のターンに与えるダメージ量が2.5倍になる
- 回復
    - ホイミ　回復
    - ベホマラー　全体回復
    - リホイミ　毎ターン小回復
- 蘇生
    - ザオラル　蘇生
    - メガザル　味方全員を全回復&蘇生

### 方針

デバフは短期的な効果、バフは長期的な効果にする。攻撃力は短期向き、守備力は長期向きで効果の影響が出やすい。ヘナトス＞バイキルト、　スカラ＞ルカニ　にする。
ミッドレンジ＜コントロール＜アグロ＜ミッドレンジの三竦みでバランスを取る
攻撃・回復のバランス型＜バフ、デバフを的確に使い盤面をコントロール＜回復なし高火力技でアグレッシブに攻め切る

## キャラ

## 🛡️ タンク系

### 1. ガルド — 鋼壁の戦士

- **特徴:** 物理防御が非常に高い。味方を守る鉄壁。
- **スキル:**
    - **仁王立ち、兜割り**

### 2. シェイド — 守護の暗騎士

- **特徴:** 防御と攻撃のバランス型。妨害も得意。
- **スキル:**
    - **刃砕き、おたけび**

---

## ⚔️ アタッカー系

### 3. リオ — 疾風の武闘家

- **特徴:** 高速アタッカー。素早さが最速クラス。
- **スキル:**
    - **疾風突き、はやぶさ斬り**

### 4. バルガス — 狂戦士オーガ

- **特徴:** 一撃の火力特化。短期決戦型。
- **スキル:**
    - **捨て身攻撃、なぎ払い**

---

## 🔮 メイジ系

### 5. アリア — 炎の魔導士

- **特徴:** 高火力・単体集中タイプ。
- **スキル:**
    - **メラミ、メラゾーマ、ピオラ**

### 6. ルフナ — 幻惑の術士

- **特徴:** 範囲魔法とデバフの専門家。
- **スキル:**
    - **イオラ、ルカニ、ヘナトス**

---

## 💖 ヒーラー系

### 7. セレス — 聖光の僧侶

- **特徴:** 回復と蘇生の専門家。パーティの命綱。
- **スキル:**
    - **ベホマラー、スカラ、ザオラル**

### 8. フィオナ — 祝福の導師

- **特徴:** バフを駆使する支援型ヒーラー。
- **スキル:**
    - **ホイミ、バイキルト、マジックバリア**

### モンスター

- ゴーレム
    - 仁王立ち、兜割り
- トロル
    - おたけび、刃砕き
- メガザルロック
    - メガザル、ミラクルソード
- キラーパンサー
    - 疾風突き、はやぶさ斬り
- バーサーカー
    - 捨て身攻撃、なぎ払い
- おおきづち
    - ためる、五月雨突き
- メラゴースト
    - メラミ、メラゾーマ
- ベビーサタン
    - イオラ、イオナズン
- ようじゅつし
    - バイキルト、ヘナトス
- ホイミスライム
    - ホイミ、マジックバリア
- キメラ
    - ベホマラー、ザオラル
- メーダ
    - リホイミ、スカラ

### 戦闘ロジック

- ターゲットが行動確定前に戦闘不能になっていた場合、ランダムなターゲットに変更する。回復する味方が戦闘不能になっていた場合は、自身をターゲットにする。

### なくてもよいが追加したい要素

- 勝利報酬で勇者を強くするシステム
    - ゲーム開始時に勇者のステータス割り振り、スキル選択を行う。
        - ステータスはHP、MP、攻撃力、防御力、素早さを5段階で割り振る。
        - スキルはミラクルソード、ためる、メラミ、ホイミから選択。ここで戦士、武道家、魔法使い、僧侶ビルドが決まる。
    - 仲間を2人選択する。
    - 勝利報酬でステータス強化 or 新スキル習得（今のビルドに合うものがランダム表示）
- 素早さが相手より高いほどクリティカル率Up
- 特性（特技でも可）
    - 身かわしアップ、AI2回行動、会心出やすい、瀕死で会心、メタルボディ、連続ため、自動MP回復、回復得意
- ドラクエ9の必殺技システムで逆転要素
    - 一喝、テンションブースト、妖精たちのポルカ、マスターゾーン、ゴスペルソング

### 仕様書

```jsx
ファイル構造（ここまで大規模な構造にはしないためあくまで参考）
src/
├── domain/                          # ドメイン層（ビジネスロジック）
│   ├── models/                      # エンティティと値オブジェクト
│   │   ├── Character.ts            # キャラクターエンティティ
│   │   ├── Skill.ts                # スキル値オブジェクト
│   │   ├── Team.ts                 # チームエンティティ（集約ルート）
│   │   ├── BattleState.ts          # バトル状態エンティティ
│   │   ├── Action.ts               # アクション値オブジェクト
│   │   ├── Status.ts               # ステータス値オブジェクト
│   │   ├── Buff.ts                 # バフ/デバフ値オブジェクト
│   │   └── BattleLog.ts            # バトルログ値オブジェクト
│   │
│   ├── services/                    # ドメインサービス
│   │   ├── DamageCalculator.ts    # ダメージ計算ロジック
│   │   ├── TargetSelector.ts      # ターゲット選択ロジック
│   │   ├── TurnOrderResolver.ts   # ターン順解決
│   │   ├── SkillExecutor.ts       # スキル実行ロジック
│   │   └── BattleJudge.ts         # 勝敗判定
│   │
│   ├── repositories/                # リポジトリインターフェース
│   │   ├── ICharacterRepository.ts
│   │   ├── ISkillRepository.ts
│   │   └── IBattleStateRepository.ts
│   │
│   └── events/                      # ドメインイベント
│       ├── CharacterDefeatedEvent.ts
│       ├── BattleWonEvent.ts
│       ├── SkillUsedEvent.ts
│       └── DamageDealtEvent.ts
│
├── application/                     # アプリケーション層（ユースケース）
│   ├── usecases/
│   │   ├── SelectTeamUseCase.ts    # チーム選択
│   │   ├── StartBattleUseCase.ts   # 戦闘開始
│   │   ├── ExecuteCommandUseCase.ts # コマンド実行
│   │   ├── SelectTargetUseCase.ts  # ターゲット選択
│   │   ├── ExecuteTurnUseCase.ts   # ターン実行
│   │   └── NextBattleUseCase.ts    # 次の戦闘へ
│   │
│   ├── dto/                         # データ転送オブジェクト
│   │   ├── CharacterDTO.ts
│   │   ├── BattleStateDTO.ts
│   │   └── CommandDTO.ts
│   │
│   └── services/                    # アプリケーションサービス
│       ├── EnemyAIService.ts       # 敵AI
│       └── BattleOrchestrator.ts   # 戦闘全体の制御
│
├── infrastructure/                  # インフラ層（技術的詳細）
│   ├── repositories/                # リポジトリ実装
│   │   ├── InMemoryCharacterRepository.ts
│   │   ├── InMemorySkillRepository.ts
│   │   └── InMemoryBattleStateRepository.ts
│   │
│   ├── data/                        # マスターデータ
│   │   ├── characterData.ts        # キャラクター定義
│   │   └── skillData.ts            # スキル定義
│   │
│   └── persistence/                 # 永続化（将来の拡張用）
│       └── LocalStorageAdapter.ts
│
├── presentation/                    # プレゼンテーション層（UI）
│   ├── components/                  # Reactコンポーネント
│   │   ├── BattleGame.tsx          # メインコンポーネント
│   │   ├── TeamSelectionScreen.tsx
│   │   ├── BattleScreen.tsx
│   │   ├── CharacterCard.tsx
│   │   ├── CommandPanel.tsx
│   │   ├── SkillSelector.tsx
│   │   ├── BattleLog.tsx
│   │   ├── HPBar.tsx
│   │   ├── MPBar.tsx
│   │   └── ResultScreen.tsx
│   │
│   ├── hooks/                       # カスタムフック
│   │   ├── useBattle.ts            # バトル状態管理
│   │   ├── useTeamSelection.ts     # チーム選択管理
│   │   └── useCommand.ts           # コマンド入力管理
│   │
│   ├── viewmodels/                  # ビューモデル
│   │   ├── BattleViewModel.ts
│   │   └── CharacterViewModel.ts
│   │
│   └── presenters/                  # プレゼンター
│       ├── BattlePresenter.ts
│       └── CommandPresenter.ts
│
├── shared/                          # 共通
│   ├── types/                       # 型定義
│   │   ├── GameState.ts
│   │   ├── SkillType.ts
│   │   └── TargetType.ts
│   │
│   ├── constants/                   # 定数
│   │   └── gameConstants.ts
│   │
│   └── utils/                       # ユーティリティ
│       ├── random.ts
│       └── calculation.ts
│
└── App.tsx                          # エントリーポイント
```

## 📁 各層の責務

### **Domain層（ドメイン層）**

- **役割**: ビジネスルールとゲームのコアロジック
- **特徴**: フレームワーク非依存、最も重要な層
- **例**:
    - `Character.ts`: HPが0になったら戦闘不能になる
    - `DamageCalculator.ts`: ダメージ計算式
    - `BattleJudge.ts`: 勝敗条件の判定

### **Application層（アプリケーション層）**

- **役割**: ユースケースの実装、ドメインの組み合わせ
- **特徴**: トランザクション境界、フロー制御
- **例**:
    - `ExecuteCommandUseCase.ts`: コマンド→ターゲット選択→実行
    - `EnemyAIService.ts`: 敵の行動決定

### **Infrastructure層（インフラ層）**

- **役割**: 技術的な実装詳細
- **特徴**: データアクセス、外部サービス連携
- **例**:
    - `InMemoryCharacterRepository.ts`: キャラデータの取得
    - `characterData.ts`: マスターデータ

### **Presentation層（プレゼンテーション層）**

- **役割**: ユーザーインターフェース
- **特徴**: React、状態管理、イベントハンドリング
- **例**:
    - `BattleScreen.tsx`: 戦闘画面の表示
    - `useBattle.ts`: 戦闘状態の管理

## 🔑 重要なポイント

1. **依存の方向**: Presentation → Application → Domain ← Infrastructure
2. **Domain層は他の層に依存しない**（依存性逆転の原則）
3. **集約ルート**: `Team`や`BattleState`が集約の境界
4. **ドメインイベント**: 状態変化を他の部分に通知
5. **リポジトリパターン**: データアクセスの抽象化
